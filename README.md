# 🤖 MegaBot

یک ربات تلگرام همه‌کاره برای مدیریت فروشگاه، پشتیبانی، سرگرمی و هوش مصنوعی — با پشتیبانی از PostgreSQL و Aiogram 3 به صورت کاملاً ماژولار.

---

## 📌 ویژگی‌های اصلی

* ثبت و مدیریت کاربران
* سیستم فروشگاه (لیست محصولات، سفارش، پرداخت فرضی)
* ماژول پشتیبانی (تیکت و پاسخ توسط ادمین)
* چت‌بات هوشمند (پشتیبانی از ChatGPT)
* ترجمه، خلاصه‌سازی، OCR تصویر و تبدیل ویس
* سیستم ضداسپم و اخطار هوشمند
* داشبورد آماری ادمین همراه با نمودار
* ذخیره پیام‌ها برای لاگ و تحلیل

---

## 🧱 ساختار پروژه

```
megabot/
├── main.py               # نقطه شروع پروژه
├── .env                  # متغیرهای محیطی (توکن، دیتابیس، ادمین‌ها)
├── bot.py                # ساخت bot و dispatcher
├── config.py             # بارگذاری تنظیمات از .env و pydantic
│
├── database/             # مدل‌ها و تعاملات با دیتابیس
│   ├── db.py             # اتصال به PostgreSQL و init_db
│   ├── models.py         # مدل اصلی User
│   ├── products.py       # جدول محصولات
│   ├── orders.py         # جدول سفارشات
│   ├── tickets.py        # جدول تیکت‌ها
│   ├── warnings.py       # اخطارها
│   ├── messages.py       # ثبت پیام‌های کاربران
│   └── users.py          # امتیازدهی و مدیریت کاربر
│
├── handlers/             # هندلرهای دستورهای ربات
│   ├── start.py          # دستور /start
│   ├── help.py           # دستور /help
│   ├── shop.py           # فروشگاه /shop
│   ├── ticket.py         # پشتیبانی /ticket
│   ├── ai_handler.py     # چت‌بات /ask، /translate، /summarize
│   ├── admin_dashboard_handler.py  # دستور /stats
│
├── middlewares/
│   ├── anti_spam.py      # جلوگیری از اسپم و فحاشی
│   ├── message_logger.py # ثبت پیام‌ها
│
├── modules/
│   ├── ai/
│   │   ├── chatgpt.py    # اتصال به OpenAI
│   │   ├── translate.py  # ترجمه متن
│   │   └── summarizer.py # خلاصه‌سازی متن
│   └── vision/
│       ├── ocr.py        # استخراج متن از تصویر
│       └── voice_to_text.py # تبدیل ویس
```

---

## 🚀 نصب و اجرا (لوکال)

```bash
# نصب پکیج‌ها
pip install -r requirements.txt

# تنظیم .env
cp .env.example .env  # یا دستی بسازید

# اجرای ربات
python main.py
```

---

## 🔐 فایل `.env` نمونه

```
BOT_TOKEN=...            # توکن ربات تلگرام
DATABASE_URL=postgresql+asyncpg://user:pass@localhost:5432/db
ADMINS=123456789,987654321
```

---

## 💬 دستورات تلگرامی

| دستور        | توضیح                |
| ------------ | -------------------- |
| `/start`     | ثبت کاربر جدید       |
| `/help`      | راهنما               |
| `/shop`      | نمایش محصولات و خرید |
| `/ticket`    | ارسال تیکت پشتیبانی  |
| `/ask`       | پرسش از ChatGPT      |
| `/translate` | ترجمه متن            |
| `/summarize` | خلاصه‌سازی متن       |
| `/stats`     | آمار برای ادمین      |

---

## 📊 آمار ادمین

با دستور `/stats` نمودار تعداد کاربران، پیام‌ها و سفارش‌ها به صورت تصویری ارسال می‌شود.

---

## 🧠 توسعه و افزودن ماژول جدید

ساختار پروژه به‌صورت ماژولار طراحی شده است. برای افزودن ماژول:

* یک فایل در `handlers/` ایجاد کنید
* مدل دیتابیس در `database/`
* تابع مربوطه در `modules/` در صورت نیاز
* در `main.py` ماژول جدید را `include_router` کنید

---

## ✅ TODO های آینده

* اتصال به درگاه پرداخت زرین‌پال یا کریپتو
* پنل تحت وب برای ادمین‌ها (مثلاً با FastAPI + AdminBro)
* افزودن بازی امتیازی و رده‌بندی
* سیستم تنظیمات داینامیک از دیتابیس

---


